<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
<mapper namespace="com.edu.product">

	
	<!-- 검색조건 -->
	<sql id="search">
		<if test="searchType != null">
			And product_name LIKE CONCAT('%', #{keyword}, '%')
		</if>
	</sql>
	
	<!-- Type별 List 불러오기 + 정렬 + 검색 -->
	<select id="typeList" parameterType="Map" resultType="com.edu.product.dto.ProductDTO">
		select product_code, product_type, product_color, product_size, product_price, product_date, product_name, star_avg
		from (select product_code, product_type, product_color, product_size, product_price, product_date, product_name, star_avg,
		row_number() over( 
			order by product_date DESC
		) as rNum from t_product where product_color = #{product_color}
									   and product_type in  
								<foreach collection="arrShopList" item="item" open="(" close=")" separator=",">
								 #{item}
								</foreach>
		
		<include refid="search"/>
		) bpd
		where rNUM BETWEEN (#{perPageNum} * #{page} - 8) and (#{perPageNum} * #{page}) 
	</select>
	
	<!-- Type + 전체 별 전체 데이터 갯수 -->
	<select id="totalCount" parameterType="Map" resultType="Integer">

			select count(*) from t_product where product_color = #{product_color} 
										    and product_type in  
											<foreach collection="arrShopList" item="item" open="(" close=")" separator=",">
											 #{item}
											</foreach>
										   	and 1=1
		<include refid="search"/>
	</select>
	
	<!-- 리스트에 쓰일 대표이미지 가져오기 -->
	<select id="ImageName" parameterType="String" resultType="String">
		<![CDATA[
			select images01 from t_images where product_code = #{product_code}
		]]>
	</select>
	

</mapper>